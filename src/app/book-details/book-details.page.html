

<app-loader
  *ngIf="isLoading "
  [text]="'Loading Book Details!'"
  subtext="Loading your reading journey..."
></app-loader>
<ion-content
  *ngIf="!isLoading && book"
  class="uber-dashboard"
  [fullscreen]="true"
  [scrollY]="true"
  [scrollX]="false"
  [scrollEvents]="true"
  (ionScroll)="onScroll($event)"
  [class.header-visible]="!hideHeader"
>

  <!-- Uber Header -->
  <div class="uber-header" [class.scrolled]="headerScrolled">
    <div class="header-content">
      <button class="back-btn" (click)="goBack()" aria-label="Go back">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </button>
      <div class="header-title" *ngIf="headerScrolled">{{ book.title | truncate:24 }}</div>
      <div class="spacer"></div>
      <button class="action-btn" (click)="shareBook()" aria-label="Share book">
        <ion-icon name="share-outline"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Book Hero Section -->
  <div class="uber-hero" style="margin-top: var(--total-header-height);">
    <div class="uber-hero-container">
      <div class="uber-hero-cover">
        <ng-container *ngIf="book.image && book.image !== ''; else bookPlaceholder">
          <img
            [src]="book.image"
            [alt]="book.title"
            class="uber-hero-image"
            (error)="book.image = ''"
            loading="lazy"
          />
        </ng-container>
        <ng-template #bookPlaceholder>
          <div class="uber-placeholder-cover" [ngClass]="getGradientClass(book.title)">
            <div class="uber-book-initials">{{ getInitials(book.title) }}</div>
          </div>
        </ng-template>
      </div>

      <div class="uber-hero-content">
        <div class="uber-hero-header">
          <h1 class="uber-hero-title">{{ book.title }}</h1>
          <p class="uber-hero-subtitle">by {{ book.author }}</p>
          <div class="uber-book-info">
            <div class="info-item">
              <ion-icon name="document-text-outline"></ion-icon>
              <span>{{ getEstimatedPages() }} pages</span>
            </div>
            <div class="info-item">
              <ion-icon name="time-outline"></ion-icon>
              <span>{{ getReadingTime() }} min read</span>
            </div>

            <div class="info-item" *ngIf="book.genres && book.genres.length > 0">
              <ion-icon name="pricetag-outline"></ion-icon>
              <span>{{ book.genres[0].name }}</span>
            </div>
          </div>
          <div class="uber-hero-meta">
            <div class="uber-rating" *ngIf="book.rating">
              <div class="uber-rating-stars">
                <ion-icon
                  *ngFor="let star of getStarsArray(book.rating)"
                  [name]="star ? 'star' : 'star-outline'"
                  [class.filled]="star"
                ></ion-icon>
              </div>
              <span class="uber-rating-text">{{ book.rating | number:'1.1-1' }} <span class="rating-total">/ 5</span></span>
            </div>
          </div>
        </div>

        <div class="uber-hero-actions">
          <button class="uber-button primary" (click)="startReading()">
            <ion-icon name="book-outline" slot="start"></ion-icon>
            <span>Read Now</span>
          </button>
          <button class="uber-button secondary" (click)="toggleBookmark()" [class.bookmarked]="isBookmarked">
            <ion-icon [name]="isBookmarked ? 'bookmark' : 'bookmark-outline'"></ion-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

    <!-- Book Description Section -->
    <div class="uber-section description-section" *ngIf="book.description">
      <div class="uber-section-header">
        <h3 class="uber-section-title">About this book</h3>
      </div>
      <div class="uber-section-content">
        <p class="uber-book-description">{{ book.description }}</p>
      </div>
    </div>

    <!-- Genres Section -->
    <div class="uber-section genres-section" *ngIf="book.genres && book.genres.length > 0">
      <div class="uber-section-header">
        <h3 class="uber-section-title">Genres</h3>
      </div>
      <div class="uber-section-content">
        <div class="uber-genres-scroll">
          <div class="uber-genre-tag" *ngFor="let genre of book.genres">
            {{ genre.name }}
          </div>
        </div>
      </div>
    </div>

    <!-- Similar Books Section with Horizontal Scroll -->
    <div class="uber-section similar-books-section" *ngIf="similarBooks && similarBooks.length > 0">
      <div class="uber-section-header">
        <h3 class="uber-section-title">Similar Books</h3>
        <button class="see-all-btn" (click)="seeAllBooks()">
          <span>See All</span>
          <ion-icon name="chevron-forward-outline"></ion-icon>
        </button>
      </div>
      <div class="uber-section-content">
        <div class="uber-books-horizontal-scroll">
          <div
            *ngFor="let similarBook of similarBooks"
            class="uber-book-card-horizontal"
            (click)="openBook(similarBook)"
          >
            <div class="uber-book-cover">
              <ng-container *ngIf="similarBook.image && similarBook.image !== ''; else similarPlaceholder">
                <img
                  [src]="similarBook.image"
                  [alt]="similarBook.title"
                  class="uber-book-image"
                  (error)="similarBook.image = ''"
                  loading="lazy"
                />
              </ng-container>
              <ng-template #similarPlaceholder>
                <div class="uber-placeholder-cover" [ngClass]="getGradientClass(similarBook.title)">
                  <div class="uber-book-initials">{{ getInitials(similarBook.title) }}</div>
                </div>
              </ng-template>
            </div>
            <div class="uber-book-info">
              <h4 class="uber-book-title">{{ similarBook.title }}</h4>
              <p class="uber-book-author">{{ similarBook.author }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    </ion-content>
