<ng-container *ngIf="isLoading">
  <div class="spinner-fullscreen">
    <ion-spinner name="crescent"></ion-spinner>
  </div>
</ng-container>

<ng-container *ngIf="!isLoading && book">
  <ion-content class="modern-book-details ion-padding" [fullscreen]="true">
    <!-- Status Bar -->
    <div class="status-bar"></div>
    
    <!-- Modern Header -->
    <div class="modern-header">
      <div class="header-content">
        <button class="modern-back-btn" (click)="goBack()">
          <ion-icon name="arrow-back-outline"></ion-icon>
        </button>
        <div class="header-title">
          <h2>Book Details</h2>
          <p>{{ book.title }}</p>
        </div>
        <button class="modern-action-btn" (click)="shareBook()">
          <ion-icon name="share-outline"></ion-icon>
        </button>
      </div>
    </div>

    <!-- Simple Book Details Content -->
    <div class="book-details-content">
      <!-- Book Hero Section -->
      <div class="book-hero">
        <div class="hero-content">
          <div class="book-cover-container">
            <ng-container *ngIf="book.image && book.image !== ''; else bookPlaceholder">
              <img 
                [src]="book.image" 
                [alt]="book.title"
                class="book-cover"
                (error)="book.image = ''"
              />
            </ng-container>
            <ng-template #bookPlaceholder>
              <div class="placeholder-cover" [ngClass]="getGradientClass(book.title)">
                <span>{{ getInitials(book.title) }}</span>
              </div>
            </ng-template>
          </div>
          
          <div class="book-info">
            <div class="book-meta">
              <h1 class="book-title">{{ book.title }}</h1>
              <p class="book-author">by {{ book.author }}</p>
              
              <div class="book-rating" *ngIf="book.rating">
                <div class="rating-stars">
                  <ion-icon 
                    *ngFor="let star of getStarsArray(book.rating)" 
                    [name]="star ? 'star' : 'star-outline'"
                    [class.filled]="star">
                  </ion-icon>
                </div>
                <span class="rating-text">{{ book.rating }} / 5</span>
              </div>
              
              <div class="book-details-meta" *ngIf="book.genres && book.genres.length > 0">
                  <div *ngFor="let genre of book.genres">
                    <span class="book-genre">
                      {{ genre.name }}
                    </span>
                  </div>
              </div>
            </div>
            
            <div class="book-actions">
              <button class="primary-btn" (click)="startReading()">
                <ion-icon name="book-outline"></ion-icon>
                <span>Read Now</span>
              </button>
              <button class="secondary-btn" (click)="toggleBookmark()">
                <ion-icon name="bookmark-outline"></ion-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Book Description -->
      <div class="section-card" *ngIf="book.description">
        <div class="section-header">
          <h3>About this book</h3>
        </div>
        <p class="book-description">{{ book.description }}</p>
      </div>

      <!-- Genres -->
      <div class="section-card" *ngIf="book.genres && book.genres.length > 0">
        <div class="section-header">
          <h3>Genres</h3>
        </div>
        <div class="genre-list">
          <span 
            *ngFor="let genre of book.genres" 
            class="genre-chip"
          >
            {{ genre.name }}
          </span>
        </div>
      </div>

      <!-- Similar Books -->
      <div class="section-card" *ngIf="similarBooks && similarBooks.length > 0">
        <div class="section-header">
          <h3>Similar Books</h3>
        </div>
        <div class="similar-books">
          <div 
            *ngFor="let similarBook of similarBooks" 
            class="similar-book"
            (click)="openBook(similarBook)"
          >
            <div class="similar-cover">
              <ng-container *ngIf="similarBook.image && similarBook.image !== ''; else similarPlaceholder">
                <img 
                  [src]="similarBook.image" 
                  [alt]="similarBook.title"
                  (error)="similarBook.image = ''"
                />
              </ng-container>
              <ng-template #similarPlaceholder>
                <div class="placeholder-cover small" [ngClass]="getGradientClass(similarBook.title)">
                  <span>{{ getInitials(similarBook.title) }}</span>
                </div>
              </ng-template>
            </div>
            <div class="similar-info">
              <h4>{{ similarBook.title }}</h4>
              <p>{{ similarBook.author }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ion-content>
</ng-container>
